@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
    <meta content="telephone=no" name="format-detection">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>会员中心-@{@WorkContext.SellerInfo.SellerName}</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
     <link rel="stylesheet" href="/Mobile/Themes/huadong/static/layui/layui.mobile.css">
    <link rel="stylesheet" href="/Mobile/Themes/huadong/static/layui/layim.css">
    <link rel="stylesheet" type="text/css" href="/Mobile/weui/style/weui.css" />
    <link rel="stylesheet" type="text/css" href="/Mobile/weui/style/weui2.css" />
     <link rel="stylesheet" type="text/css" href="/Mobile/weui/icon/icon.css" />
    <link rel="stylesheet" href="/Mobile/Themes/huadong/static/usercenter/home/usercenter.css?v=0.05">
    <script src="/Mobile/weui/zepto.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="/Mobile/weui/ydui.flexible.js" type="text/javascript" charset="utf-8"></script>
    <script src="/Mobile/weui/icon/iconfont.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" type="text/css" href="/Mobile/weui/style/loading.css"/>
    <script src="/Js/vue/dist/vue.min.js" type="text/javascript" charset="utf-8"></script> 
    <script type='text/javascript' src='/Mobile/webim/demo/javascript/dist/webim.config.js'></script>
	<script type='text/javascript' src='/Mobile/webim/sdk/dist/strophe-1.2.8.min.js'></script>
	<script src='/Mobile/webim/sdk/dist/websdk-1.4.13.js'></script>
	<script src="/Mobile/webim/webrtc/dist/webrtc-1.4.13.js" type="text/javascript" charset="utf-8"></script>
    <!--<script src="/Mobile/Themes/huadong/static/layui/layui.js"></script>-->
    <!--<script src="/Mobile/Themes/huadong/static/layui/mobile.js"></script>-->
	<style type="text/css">
		.layim-title{width:7.5rem;margin:0 auto;padding:0;}
		.layim-content{width:7.5rem;margin:0 auto}
		.layim-tab-content{width:7.5rem;margin:0 auto}
		.layim-title p{width:7.2rem;margin:0 auto}
		/*.layim-chat-main{width:7.5rem;margin:0 auto;}*/
		.layim-chat-main{padding:15px 0;}
	</style>
</head>
<body>
<div id="app">
	<div id="layui-m-layer0" class='layui-m-layer layui-m-layer1'>
		<div class="layui-m-layermain">
			<div class="layui-m-layersection">
				<div class="layui-m-layerchild layui-m-anim--1">
					<div class="layui-m-layercont">
						<div class="layim-panel layui-m-anim-left">
							<div class="layim-title" style="background-color: #36373C;">
								<p>我的IM<span class="layim-chat-status"></span></p>
							</div>
							<div class="layui-unselect layim-content">
								<div class="layui-layim">
									<div class="layim-tab-content layui-show">
										<ul class='layim-list-friend'>
											<ul class='layui-layim-list layui-show layim-list-history'>
												<li layim-event="chat" data-type="history" data-index="friend100001" class="layim-friend100001" v-on:click='viewDetail()'>
													<div>
														<img src="//tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg">
													</div>
													<span>贤心</span>
													<p>嗨，欢迎体验LayIM。演示标记：1535969322917</p>
													<span class="layim-msg-status layui-show">1</span>
												</li>
												<li layim-event="chat" data-type="history" data-index="friend100001" class="layim-friend100001 "  v-on:click='viewDetail()'>
													<div>
														<img src="//tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg">
													</div>
													<span>贤心</span>
													<p>嗨，欢迎体验LayIM。演示标记：1535969322917</p>
													<span class="layim-msg-status layui-show">1</span>
												</li>
											</ul>
										</ul>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!--详情-->
	<div id="layui-m-layer1" class='layui-m-layer layui-m-layer1' v-if='isdetail'>
		<div class="layui-m-layermain">
			<div class="layui-m-layersection">
				<div class="layui-m-layerchild  layui-m-anim--1">
					<div class="layui-m-layercont">
						<div class="layim-panel layui-m-anim-left">
							<div class="layim-title" style="background-color: #36373C;">
								<p>
									<i class="layui-icon layim-chat-back iconfont" layim-event="back" v-on:click='viewDetail()'> &#xe60e; </i>
									贤心<span class="layim-chat-status"></span>
								</p>
							</div>
							<div class="layui-unselect layim-content">
								<div class="layim-chat layim-chat-friend">
									<div class="layim-chat-main">
										<div class="layim-chat-system">
											<span layim-event="chatLog">查看更多记录</span>
										</div>
										<ul style='width:7.1rem;margin:0 auto'>
											<li class="layim-chat-li layim-chat-mine">
												<div class="layim-chat-user">
													<img src="//cdn.layui.com/upload/2017_2/168_1487445347637_70429.jpg">
													<cite>纸飞机</cite>
												</div>
												<div class="layim-chat-text">cvdscv </div>
											</li>
											<li class="layim-chat-li">
												<div class="layim-chat-user">
													<img src="//tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg">
													<cite>贤心</cite>
												</div>
												<div class="layim-chat-text">洗澡中，请勿打扰，偷窥请购票，个体四十，团体八折，订票电话：一般人我不告诉他！
													<img alt="[哈哈]" title="[哈哈]" src="https://res.layui.com/layui/dist/images/face/2.gif">
												</div>
											</li>
										</ul>
									</div>
									<div class="layim-chat-footer">
										<div class="layim-chat-send">
											<input type="text" autocomplete="off">
											<button class="layim-send layui-disabled" layim-event="send">发送</button>
										</div>
										<div class="layim-chat-tool" data-json="%7B%22username%22%3A%22%E8%B4%A4%E5%BF%83%22%2C%22avatar%22%3A%22%2F%2Ftva1.sinaimg.cn%2Fcrop.0.0.118.118.180%2F5db11ff4gw1e77d3nqrv8j203b03cweg.jpg%22%2C%22id%22%3A%22100001%22%2C%22type%22%3A%22friend%22%2C%22cid%22%3A63889%2C%22content%22%3A%22%E5%97%A8%EF%BC%8C%E6%AC%A2%E8%BF%8E%E4%BD%93%E9%AA%8CLayIM%E3%80%82%E6%BC%94%E7%A4%BA%E6%A0%87%E8%AE%B0%EF%BC%9A1535974100501%22%2C%22timestamp%22%3A1535974100502%2C%22name%22%3A%22%E8%B4%A4%E5%BF%83%22%2C%22historyTime%22%3A1535974100504%2C%22sign%22%3A%22%E5%97%A8%EF%BC%8C%E6%AC%A2%E8%BF%8E%E4%BD%93%E9%AA%8CLayIM%E3%80%82%E6%BC%94%E7%A4%BA%E6%A0%87%E8%AE%B0%EF%BC%9A1535974100501%22%7D">
										<span class="layui-icon layim-tool-face" title="选择表情" layim-event="face">
										</span>
										<span class="layui-icon layim-tool-image" title="上传图片" layim-event="image">
											<input type="file" name="file" accept="image/*">
										</span>
										<span class="layui-icon layim-tool-image" title="发送文件" layim-event="image" data-type="file">
											<input type="file" name="file">
										</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
</body>
<script>
	var vm = new Vue({
     	el: '#app',
     	data:{
     		isdetail:false
     	},
     	methods:{
     		viewDetail:function(){
     			var _this=this;
     			_this.isdetail=!_this.isdetail;
     		}
     	}
    })
</script>
<script>
		function webim_func(){
			var uname = '65114';
			var pwd = 'huadong518';
			var toname = '65114';
		    var conn = new WebIM.connection({
			    isMultiLoginSessions: WebIM.config.isMultiLoginSessions,
			    https: typeof WebIM.config.https === 'boolean' ? WebIM.config.https : location.protocol === 'https:',
			    url: WebIM.config.xmppURL,
			    heartBeatWait: WebIM.config.heartBeatWait,
			    autoReconnectNumMax: WebIM.config.autoReconnectNumMax,
			    autoReconnectInterval: WebIM.config.autoReconnectInterval,
			    apiUrl: WebIM.config.apiURL,
			    isAutoLogin: true
			});
		    conn.listen({
			    onOpened: function ( message ) {          //连接成功回调
			        // 如果isAutoLogin设置为false，那么必须手动设置上线，否则无法收消息
			        // 手动上线指的是调用conn.setPresence(); 如果conn初始化时已将isAutoLogin设置为true
			        // 则无需调用conn.setPresence();             
			    },  
			    onClosed: function ( message ) {},         //连接关闭回调
			    onTextMessage: function ( message ) {
			    	console.log(message);
			    	$("#recive").val(message.data);
			    },    //收到文本消息
			    onEmojiMessage: function ( message ) {},   //收到表情消息
			    onPictureMessage: function ( message ) {
			    	console.log(message);
			    	$("#image_recive").attr("src",message.url);
			    }, //收到图片消息
			    onCmdMessage: function ( message ) {},     //收到命令消息
			    onAudioMessage: function ( message ) {},   //收到音频消息
			    onLocationMessage: function ( message ) {},//收到位置消息
			    onFileMessage: function ( message ) {},    //收到文件消息
			    onVideoMessage: function (message) {
			        var node = document.getElementById('privateVideo');
			        var option = {
			            url: message.url,
			            headers: {
			              'Accept': 'audio/mp4'
			            },
			            onFileDownloadComplete: function (response) {
			                var objectURL = WebIM.utils.parseDownloadResponse.call(conn, response);
			                node.src = objectURL;
			            },
			            onFileDownloadError: function () {
			                console.log('File down load error.')
			            }
			        };
			        WebIM.utils.download.call(conn, option);
			    },   //收到视频消息
			    onPresence: function ( message ) {},       //处理“广播”或“发布-订阅”消息，如联系人订阅请求、处理群组、聊天室被踢解散等消息
			    onRoster: function ( message ) {},         //处理好友申请
			    onInviteMessage: function ( message ) {},  //处理群组邀请
			    onOnline: function () {},                  //本机网络连接成功
			    onOffline: function () {},                 //本机网络掉线
			    onError: function ( message ) {},          //失败回调
			    onBlacklistUpdate: function (list) {       //黑名单变动
			        // 查询黑名单，将好友拉黑，将好友从黑名单移除都会回调这个函数，list则是黑名单现有的所有好友信息
			        console.log(list);
			    },
			    onReceivedMessage: function(message){},    //收到消息送达服务器回执
			    onDeliveredMessage: function(message){},   //收到消息送达客户端回执
			    onReadMessage: function(message){},        //收到消息已读回执
			    onCreateGroup: function(message){},        //创建群组成功回执（需调用createGroupNew）
			    onMutedMessage: function(message){}        //如果用户在A群组被禁言，在A群发消息会走这个回调并且消息不会传递给群其它成员
			});
			var options = { 
			  apiUrl: WebIM.config.apiURL,
			  user: uname,
			  pwd: pwd,
			  appKey: WebIM.config.appkey,
			  success: function(rel){
			  	console.log("login success");
			  }
			};
			conn.open(options);
			
			// 单聊发送文本消息
			var sendPrivateText = function () {
			    var id = conn.getUniqueId();                 // 生成本地消息id
			    var send_msg = $("#send").val();
			    var msg = new WebIM.message('txt', id);      // 创建文本消息
			    msg.set({
			        msg: send_msg,                  // 消息内容
			        to: toname,                          // 接收消息对象（用户id）
			        roomType: false,
			        success: function (id, serverMsgId) {
			            console.log('send private text Success');
			        },
			        fail: function(e){
			            console.log("Send private text error");
			        }
			    });
			    msg.body.chatType = 'singleChat';
			    conn.send(msg.body);
			};
			// 私聊发送图片消息
		    // 单聊发送图片消息
			var sendPrivateImg = function () {
			    var id = conn.getUniqueId();                   // 生成本地消息id
			    var msg = new WebIM.message('img', id);        // 创建图片消息
			    var input = document.getElementById('image');  // 选择图片的input
			    var file = WebIM.utils.getFileUrl(input);      // 将图片转化为二进制文件
			    var allowType = {
			        'jpg': true,
			        'gif': true,
			        'png': true,
			        'bmp': true
			    };
			    if (file.filetype.toLowerCase() in allowType) {
			        var option = {
			            apiUrl: WebIM.config.apiURL,
			            file: file,
			            to: toname,                       // 接收消息对象
			            roomType: false,
			            chatType: 'singleChat',
			            onFileUploadError: function () {      // 消息上传失败
			                console.log('onFileUploadError');
			            },
			            onFileUploadComplete: function () {   // 消息上传成功
			                console.log('onFileUploadComplete');
			            },
			            success: function () {                // 消息发送成功
			                console.log('Success');
			                console.log(file);
			            },
			            flashUpload: WebIM.flashUpload
			        };
			        msg.set(option);
			        conn.send(msg.body);
			    }
			};
			document.getElementById('privateText').onclick = sendPrivateText;
			document.getElementById('privateImg').onclick = sendPrivateImg;
		}
			
		webim_func();
</script>

</html>

