@{
    Layout = null;
}
<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta content="telephone=no" name="format-detection">
	    <meta name="apple-touch-fullscreen" content="yes">
	    <meta name="apple-mobile-web-app-capable" content="yes">
	    <meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title>申请超级码-@(WorkContext.SellerInfo.SellerName)</title>
		<link rel="stylesheet" type="text/css" href="/Mobile/Themes/huadong/static/weui/style/weui.css"/>
		<link rel="stylesheet" type="text/css" href="/Mobile/Themes/huadong/static/weui/style/weui2.css"/>
		<link rel="stylesheet" type="text/css" href="/Mobile/Themes/huadong/static/font/common.css" />
    	<link rel="stylesheet" type="text/css" href="/Mobile/Themes/huadong/static/seller/supercode/supercode.css?v=0.2" />
    	<script type="text/javascript" charset="utf-8" src="/Mobile/weui/zepto.min.js"></script>
    	<script type="text/javascript" charset="utf-8" src="/Js/Mobile/updown.js"></script>
    	<script type="text/javascript" charset="utf-8" src="/Mobile/weui/ydui.flexible.js"></script>
    	<script src="/Js/vue/dist/vue.min.js" type="text/javascript" charset="utf-8"></script>
    	<style type="text/css">
			.grade_a{ display: none; }
    	</style>
	</head>
	<body>
		<div id="app" v-cloak>
			<div class="warp">
		        <div class="main">
		        	<div class="header">
				        <div class="weui-flex">
				            <div class="weui-flex-item lt" onclick="goToBack()"><span class="icon icon-109"></span></div>
				            <div class="weui-flex-item center">我的超级码</div>
				            <div class="weui-flex-item rt"></div>
				        </div>
				        <!--supper-banner start-->
				        <div class="supper-banner">
				            @if (WorkContext.WeChatUserInfo != null)
				            {
				                if (WorkContext.WeChatUserInfo.HeadImgUrl == "")
				                {
				                    if (WorkContext.UserInfo.Avatar == "")
				                    {
				                        <img src="/images/photo.png" />
				                    }
				                    else
				                    {
				                        if (WorkContext.UserInfo.Avatar.Contains("http"))
				                        {
				                            <img src="@(WorkContext.UserInfo.Avatar)" />
				                        }
				                        else
				                        {
				                            <img src="@(WorkContext.ShopConfig.ImageCDN)@{@WorkContext.UserInfo.Avatar}" />
				                        }
				                    }
				                }
				                else
				                {
				                    <div class="tx">

				                        @if (WorkContext.UserInfo.Avatar == "")
				                        {
				                            <img src="@WorkContext.WeChatUserInfo.HeadImgUrl">
				                        }
				                        else
				                        {
				                            if (WorkContext.UserInfo.Avatar.Contains("http"))
				                            {
				                                <img src="@(WorkContext.UserInfo.Avatar)" class="avatar-img" />
				                            }
				                            else
				                            {
				                                <img src="@(WorkContext.ShopConfig.ImageCDN)@{@WorkContext.UserInfo.Avatar}" />
				                            }
				                        }
				                        @if (WorkContext.UserInfo.UserType == 1)
				                        {
				                            <span class="grade_a grade_1">普通会员</span>
				                        }
				                        else if (WorkContext.UserInfo.UserType == 2)
				                        {
				                            <span class="grade_a grade_2">VIP会员</span>
				                        }
				                        else if (WorkContext.UserInfo.UserType == 3)
				                        {
				                            <span class="grade_a grade_3">实体商家</span>
				                        }
				                        else if (WorkContext.UserInfo.UserType == 4)
				                        {
				                            <span class="grade_a grade_4">区县代理</span>
				                        }
				                        else if (WorkContext.UserInfo.UserType == 5)
				                        {
				                            <span class="grade_a grade_5">市级代理</span>
				                        }
				                        else if (WorkContext.UserInfo.UserType == 6)
				                        {
				                            <span class="grade_a grade_6">省级代理</span>
				                        }
				                    </div>
				                }
				                if (WorkContext.WeChatUserInfo.UserId > 0)
				                {
				                    <span>
				                        @if (WorkContext.WeChatUserInfo.NickName == "未关注公众号用户")
				                        {
				                            @WorkContext.WeChatUserInfo.OpenId
				                        }
				                        else
				                        {
				                            @WorkContext.WeChatUserInfo.NickName
				                        }
				                    </span>
				                }
				                else
				                {
				                    <span>@WorkContext.WeChatUserInfo.NickName</span>
				                }
				            }
				            else
				            {

				                if (Yitao.Core.WebHelper.IsWeiXin())
				                {
				                    if (WorkContext.WeChatUserInfo.HeadImgUrl == "")
				                    {
				                        <div class="tx">
				                            @if (WorkContext.UserInfo.Avatar == "")
				                            {
				                                <img src="images/photo.png" />
				                            }
				                            else
				                            {
				                                if (WorkContext.UserInfo.Avatar.Contains("http"))
				                                {
				                                    <img src="@(WorkContext.UserInfo.Avatar)" />
				                                }
				                                else
				                                {
				                                    <img src="@(WorkContext.ShopConfig.ImageCDN)@(WorkContext.UserInfo.Avatar)" />
				                                }
				                            }
				                        </div>
				                    }
				                    else
				                    {
				                        <div class="tx">

				                            @if (WorkContext.UserInfo.Avatar == "")
				                            {
				                                <img src="@WorkContext.WeChatUserInfo.HeadImgUrl">
				                            }
				                            else
				                            {
				                                if (WorkContext.UserInfo.Avatar.Contains("http"))
				                                {
				                                    <img src="@(WorkContext.UserInfo.Avatar)" />
				                                }
				                                else
				                                {
				                                    <img src="@(WorkContext.ShopConfig.ImageCDN)@(WorkContext.UserInfo.Avatar)" />
				                                }
				                            }


				                            @if (WorkContext.UserInfo.UserType == 1)
				                            {
				                                <span class="grade_a grade_1">普通会员</span>
				                            }
				                            else if (WorkContext.UserInfo.UserType == 2)
				                            {
				                                <span class="grade_a grade_2">VIP会员</span>
				                            }
				                            else if (WorkContext.UserInfo.UserType == 3)
				                            {
				                                <span class="grade_a grade_3">实体商家</span>
				                            }
				                            else if (WorkContext.UserInfo.UserType == 4)
				                            {
				                                <span class="grade_a grade_4">区县代理</span>
				                            }
				                            else if (WorkContext.UserInfo.UserType == 5)
				                            {
				                                <span class="grade_a grade_5">市级代理</span>
				                            }
				                            else if (WorkContext.UserInfo.UserType == 6)
				                            {
				                                <span class="grade_a grade_6">省级代理</span>
				                            }
				                        </div>
				                    }

				                    <span>@Session["OpenId"].ToString()</span>
				                }
				                else
				                {
				                    <div class="tx">
				                        <img src="/images/photo.png" />
				                    </div>
				                    <span>@WorkContext.UserInfo.NickName</span>
				                }

				            }
				            <div class="information">
				                <!--span> <i class="icon icon-85"></i>单位：陕西第一撞</span-->
				                <span> <i class="icon icon-85"></i>好友：<span class="team-number">0</span>人</span>
				            </div>
				        </div>
				        <!--supper-banner end-->
				    </div>
					<!--today yeji-->
					<div class="recommend-jl today-yj">
				        <h5>今日业绩</h5>
				        <ul v-for="(item,index) in performanceList" :key="index">
				            <li>
				                <span>今日交易</span>
				                <h3 class="today-achievement">¥{{item.amounttoday}}</h3><br />
				                <span>总交易</span>
				                <h3 class="today-achievement">¥{{item.amountsum}}</h3>
				            </li>
				            <li>
				                <span>今日让利</span>
				                <h3 class="today-achievement">¥{{item.giftprofitstoday}}</h3><br />
				                <span>总让利</span>
				                <h3 class="today-achievement">¥{{item.giftprofitssum}}</h3>
				            </li>
				            <li>
				                <span>今日奖励</span>
				                <h3 class="today-achievement">¥{{item.scoretoday}}</h3><br />
				                <span>总奖励</span>
				                <h3 class="today-achievement">¥{{item.scoresum}}</h3>
				            </li>
				        </ul>
				    </div>
				    <!--recommend-jl start-->
				    <div class="recommend-jl">
				        <h5>我的粉丝</h5>
				        <ul>
				            <li>
				                <span>商家总数量</span>
				                <h3 class="business-all-number"></h3>
				            </li>
				            <li>
				                <span>会员总数量</span>
				                <h3 class="vip-all-number"></h3>
				            </li>
				        </ul>
				    </div>
				    <div class="recommend-jl">
				        <h5 class="my-performance">我的业绩</h5>
				    </div>
				    <!--member-cont start-->
				    <div class="member-cont clearfix">
				        <!--div class="search">
				            <input type="text" placeholder="请输入您推荐伙伴的用户名"><i class="icon icon-4"></i>
				        </div-->
				        <div class="my-member weui_panel weui_panel_access">
				            <div class="member-tit">
				                我的粉丝（<span class="team-number">0</span>）人
				            </div>
				            <ul class="member-list clearfix weui_panel_bd"></ul>
				        </div>
				    </div>
				    <!--member_cont end-->
		        </div>
			</div>
			<!--我的业绩-->
		    <div class="performance-more-content">
		        <div class="prev-page-view">
		            <div class="prev-page-btn icon icon-109"></div>
		            我的业绩
		        </div>
		        <div class="performance-more-box" v-for="(item,index) in performanceList" :key="index">
		            <div class="performance-more-div">
		                <h4 class="performance-more-title">
		                    <p class="performance-more-tips">直推业绩</p>
		                </h4>
		                <div class="performance-more-info">
		                    <div class="performance-more-infoname">商家销售交易额</div>
		                    <div class="performance-more-infovalue">¥{{item.saleuserorderamountsumself}}</div>
		                </div>
		                <div class="performance-more-info">
		                    <div class="performance-more-infoname">商家销售让利额</div>
		                    <div class="performance-more-infovalue">¥{{item.saleusergiftprofitssumself}}</div>
		                </div>
		                <div class="performance-more-info">
		                    <div class="performance-more-infoname">会员消费交易额</div>
		                    <div class="performance-more-infovalue">¥{{item.userorderamountsumself}}</div>
		                </div>
		                <div class="performance-more-info">
		                    <div class="performance-more-infoname">会员消费让利额</div>
		                    <div class="performance-more-infovalue">¥{{item.usergiftprofitssumself}}</div>
		                </div>
		            </div>

		            <div class="performance-more-div">
		                <h4 class="performance-more-title">
		                    <p class="performance-more-tips">全体系业绩</p>
		                    <p class="performance-more-tips">(包括直推业绩)</p>
		                </h4>
		                <div class="performance-more-info">
		                    <div class="performance-more-infoname">会员总数</div>
		                    <div class="performance-more-infovalue">{{item.usernum}}</div>
		                </div>
		                <div class="performance-more-info">
		                    <div class="performance-more-infoname">实体商家总数</div>
		                    <div class="performance-more-infovalue">{{item.saleusernum}}</div>
		                </div>
		                <div class="performance-more-info">
		                    <div class="performance-more-infoname">商家销售交易额</div>
		                    <div class="performance-more-infovalue">¥{{item.saleuserorderamountsumall}}</div>
		                </div>
		                <div class="performance-more-info">
		                    <div class="performance-more-infoname">商家销售让利额</div>
		                    <div class="performance-more-infovalue">¥{{item.saleusergiftprofitssumall}}</div>
		                </div>
		                <div class="performance-more-info">
		                    <div class="performance-more-infoname">会员消费交易额</div>
		                    <div class="performance-more-infovalue">¥{{item.userorderamountsumall}}</div>
		                </div>
		                <div class="performance-more-info">
		                    <div class="performance-more-infoname">会员消费让利额</div>
		                    <div class="performance-more-infovalue">¥{{item.usergiftprofitssumall}}</div>
		                </div>
		            </div>
		        </div>
		    </div>
		</div>
	</body>
	<script>
		
		//当前用户的Uid
	    var userid = @WorkContext.Uid;

		var IsApp = "@WorkContext.IsApp";

		var avImg = "@(WorkContext.UserInfo.Avatar)";

		if(IsApp == 1){
			$(".avatar-img").attr("src","/images/photo.png");
		}else{
			$(".avatar-img").attr("src",avImg);
		}
		
		function goToBack() {
			var _this = this;
    		if(IsApp==1){
				if(navigator.userAgent.indexOf("iPhone")>0){
					gobacklastpage();
				}
				if(navigator.userAgent.indexOf("Android")>0){
						window.js.goBack();
					}
			}else{
				window.location.href='/m/usercenter/home';
			}
				
		}
		
	    $(document).on("click", ".my-performance", function(){
	        $(".performance-more-content").show();
	    });

	    $(document).on("click", ".prev-page-btn", function(){
	        var performanceMore = $(this).parents(".performance-more-content");
	        if(performanceMore.length > 0){
	            performanceMore.hide();
	        }
	    });

	    //上拉加载
	    $(function(){

	        //页数初始化
	        var page = 0;
	        // 每页展示4个
	        var size = 4;
	        $('.weui_panel').dropload({
	            scrollArea : window,
	            autoLoad : true,//自动加载
	            domDown : {//上拉
	                domClass   : 'dropload-down',
	                domRefresh : '<div class="dropload-refresh f15 "><i class="icon icon-20"></i>上拉加载更多</div>',
	                domLoad    : '<div class="dro pload-load f15"><span class="weui-loading"></span>正在加载中...</div>',
	                domNoData  : '<div class="dropload-noData">没有更多会员信息了</div>'
	            },
	            loadDownFn : function(me){//加载更多
	             page++;
	             window.history.pushState(null, document.title, window.location.href);
	             var result = '';
	                $.ajax({
	                    type: 'get',
	                    url:'/Api/User/GetChildren?v='+Math.random()+'&userid='+userid+'&page='+page+'&size='+size,
	                    async: true,
	                    dataType: 'json',
	                    success: function(res){
	                        if(res.code == 1){
	                            var arrLen = res.data.length;
	                            var teamNumber = res.message; //获取团队人数
	                            var imgUrl = '@(WorkContext.ShopConfig.ImageCDN)';
	                            for(var i=0; i<arrLen; i++){
	                                var imgUrlExp = res.data[i].avatar;
	                                var http = imgUrlExp.split(":")[0]; //获取当前avatar地址的http
	                                    result  +='<li>';
	                                    result  +='<a href="/m/usercenter/MyGroupDetail?LeaderUid='+userid+'&UserId='+res.data[i].userid+'&level=1&IsApp=@WorkContext.IsApp&IsSuperCode=1">';
	                                    result  +='<div class="membership-information">';
	                                    if(res.data[i].avatar == ""){
	                                        result  +='<div class="head-portrait"><img src="/Images/Mobile/usercenter/head.png"></div>';
	                                    }else{
	                                        result  +='<div class="head-portrait">';
	                                        if (http == 'http') {//判断当前avatar地址的http存在与否以添加imgUrl路径
	                                            result  +='<img src="'+res.data[i].avatar+'" alt="" />';
	                                        }else{
	                                            result  +='<img src="'+imgUrl+res.data[i].avatar+'" alt="" />';
	                                        }
	                                        result  +='</div>';
	                                    }
	                                    if(res.data[i].usertype == 1){
                                        	result  +='<i class="icon-zuan grade_1"></i>';
	                                    }else if(res.data[i].usertype == 2){
	                                        result  +='<i class="icon-zuan grade_2"></i>';
	                                    }else if(res.data[i].usertype == 3){
	                                        result  +='<i class="icon-zuan grade_3"></i>';
	                                    }else if(res.data[i].usertype == 4){
	                                        result  +='<i class="icon-zuan grade_4"></i>';
	                                    }else if(res.data[i].usertype == 5){
	                                        result  +='<i class="icon-zuan grade_5"></i>';
	                                    }else if(res.data[i].usertype == 6){
	                                        result  +='<i class="icon-zuan grade_6"></i>';
	                                    }
	                                result  +='<p class="weui_call_number">'+res.data[i].mobile+'</p>';
	                                result  +='<span>'+timeConversion(res.data[i].addtime)+'</span>';
	                                result  +='</div>';
	                                result  +='</a>';
	                                result  +='</li>';
	                            }
	                            //console.log(page);
	                            //获取当前用户下线数量
	                            var personLen = res.message;
	                            $(".team-number").text(personLen);
	                        // 如果没有数据
	                        }else{
	                            // 锁定
	                            me.lock();
	                            // 无数据
	                            me.noData();
	                        }

	                        // 为了测试，延迟500毫秒加载
	                        setTimeout(function(){
	                            $('.weui_panel_bd').append(result);
	                            // 每次数据加载完，必须重置
	                            me.resetload();
	                        },500);
	                    },
	                    error: function(xhr, type){
	                        $.toast("Ajax error!", "forbidden");
	                        // 即使加载出错，也得重置
	                        me.resetload();
	                    }
	                });
	            }
	        });


	    });

	    // 换算会员加入时间与当前时间比差
	    function timeConversion(time){
	        var timeStampNow = new Date().getTime();
	        var timeStampAdd = new Date(time.replace(/-/g, '/')).getTime();
	        var timeStampEnd = timeStampNow - timeStampAdd;
	        var dayBefore = Math.floor(timeStampEnd/1000/60/60/24);  //获取天数
	            if(dayBefore >= 7 && dayBefore< 14){
	                return "1周前";
	            }else if(dayBefore >= 14 && dayBefore< 21){
	                return "2周前";
	            }else if(dayBefore >= 21 && dayBefore< 28){
	                return "3周前";
	            }else if(dayBefore >= 28){
	                return "1月前";
	            }else{
	                return dayBefore+"天前";
	            }
	    }

	    //获取商家总数、会员总数
	    $.ajax({
	    	type: "get",
	    	url:"/Api/Statistic/SuperUserBasic?v="+Math.random()+"&userid="+ userid,
	    	dataType: "json",
	    	async: true,
	    	success: function(res){
	    		if(res.code == 1){
	    			$(".business-all-number").text(res.data.saleusernum);
	    			$(".vip-all-number").text(res.data.usernum);
	    		}
	    	}
	    });
	</script>
	<script>
	    // 我的业绩
	    var app = new Vue({
	        el: "#app",
	        data:{
	            userid: userid,
	            performanceList:[],
	        },
	        created: function(){
	            var that = this;
	            $.get("/Api/Statistic/SuperUserExtend",{
	                userid: that.userid,
	            },function(res){
	                var rel = JSON.parse(res);
	                if(rel.code == 1){
	                    that.performanceList.push(rel.data);
	                }
	            }, "JSON");
	        }
	    });
	</script>
</html>
